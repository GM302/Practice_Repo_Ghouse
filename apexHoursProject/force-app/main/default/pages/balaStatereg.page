<apex:page >
    <!--
    html
    <template>
    <lightning-card title="State Regulatory Notifications" icon-name="standard:date_input">
        <div class="slds-p-around_medium">
            <div class="slds-grid slds-wrap slds-gutters">

                
                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                    <lightning-input type="checkbox" label="Incomplete Credential Application"
                                     checked={incomplete} onchange={handleIncompleteChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small"  onclick={openClender}>
                    commented <lightning-input type="date" variant="label-hidden"
                                    data-id="Test11"
                                     value={formattedDate}
                                     
                                     disabled={notIncomplete}
                                     onchange={handleIncompleteDateChange}></lightning-input> commented ends
                                     <input required type="date" 
                                     onchange={handleIncompleteDateChange} 
                                     value={incompleteDate} 
                                    disabled={notIncomplete}
                                    class={inputclass}
                                    oninvalid={handleInvalid}
                                    oninput={clearError}
                                    style="width: 195px; height: 35px;"
                                    data-id = "dateInput"
                                   
                                        />
                                     
                </div>

                
                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                    <lightning-input type="checkbox" label="Complete Credential Application"
                                     checked={complete} onchange={handleCompleteChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                    <lightning-input type="date" variant="label-hidden"
                                     value={completeDate}
                                     required={complete}
                                     disabled={notComplete}
                                     onchange={handleCompleteDateChange}></lightning-input>
                </div>

                
                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                    <lightning-input type="checkbox" label="Extended TAT"
                                     checked={extended} onchange={handleExtendedChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                    <lightning-input type="date" variant="label-hidden"
                                     value={extendedDate}
                                     required={extended}
                                     disabled={notExtended}
                                     onchange={handleExtendedDateChange}></lightning-input>
                </div>

                
                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                    <lightning-input type="checkbox" label="Discontinued Incomplete Data Element"
                                     checked={discontinued} onchange={handleDiscontinuedChange}></lightning-input>
                </div>
                <div class="slds-col slds-size_1-of-2 slds-m-bottom_small">
                    <lightning-input type="date" variant="label-hidden"
                                     value={discontinuedDate}
                                     required={discontinued}
                                     disabled={notDiscontinued}
                                     onchange={handleDiscontinuedDateChange}></lightning-input>
                </div>

            </div>

            
            <div class="slds-m-top_medium slds-text-align_center">
                <lightning-button label="Save" variant="brand" onclick={handleSave} disabled={isPristine}></lightning-button>
                <lightning-button label="Cancel" variant="neutral" class="slds-m-left_small" onclick={handleCancel} disabled={isPristine}></lightning-button>
            </div>
        </div>
    </lightning-card>
</template>



java script:
==============
import { LightningElement, api,track } from 'lwc';
import getCredentialRequest from '@salesforce/apex/PDMS_CRED_ReqFrameworkController.getCredentialRequest';
import updateCredentialRequest from '@salesforce/apex/PDMS_CRED_ReqFrameworkController.updateCredentialRequest';
import { ShowToastEvent } from 'lightning/platformShowToastEvent';
export default class Pdms_lwc_State_Regulatory_Notifications extends LightningElement {

@api recordId;

    incomplete = false;
    incompleteDate = '';
    complete = false;
    completeDate = '';
    extended = false;
    extendedDate = '';
    discontinued = false;
    discontinuedDate = '';

    original = {};

    connectedCallback() {
        getCredentialRequest({ recordId: this.recordId })
            .then(result => {
                this.incomplete = result.Incomplete_Cred_Application__c;
                this.incompleteDate = result.Incomplete_Cred_Application_Sent_Date__c;
                this.complete = result.Complete_Cred_Application__c;
                this.completeDate = result.Complete_Cred_Application_Sent_Date__c;
                this.extended = result.Extended_TAT__c;
                this.extendedDate = result.Extended_TAT_Sent_Date__c;
                this.discontinued = result.Discontinued_Incomplete_Data_Element__c;
                this.discontinuedDate = result.Discontinued_Incomplete_Data_Element_S__c;

                this.original = {
                    incomplete: this.incomplete,
                    incompleteDate: this.incompleteDate,
                    complete: this.complete,
                    completeDate: this.completeDate,
                    extended: this.extended,
                    extendedDate: this.extendedDate,
                    discontinued: this.discontinued,
                };
            })
            .catch(err => {
                this.showError('Failed to load record: ' + err.body.message);
            });
    }

    openClender(){
        const input = this.template.querySelector('input[data-id="dateInput"]');
        input.showPicker?.();
        input.focus();
    }
    validateInput(){
       const allFields = this.template.querySelectorAll('lightning-input[data-id="Test11"]');
       let isValid = true;
       allFields.forEach(field => {
        console.log('inside validity check ' + this.incomplete);
        console.log('Inside alidity date ' + this.incompleteDate);
        if(this.incomplete == true && this.incompleteDate == undefined){
            
            isValid = false;
        }

       });
       console.log('IsValid ' + isValid);
       return isValid;
    }

    @track inputClass= 'slds-input';
    handleInvalid(event){
        event.preventDefault();
        this.inputClass = 'slds-input slds-has-error';
    }
    clearError(){
        this.inoutClass = 'slds-input';
    }

    // Handler for Incomplete Credential Application checkbox
    handleIncompleteChange(event) {
        let check = this.validateInput();
        this.incomplete = event.target.checked;

  this.incompleteDate = this.incomplete == false? null:this.incompleteDate;
        console.log('check box ' + this.incomplete);
        console.log('incompleteDate ' + this.incompleteDate);
        if (!this.incomplete) {
            this.incompleteDate = null;  // Clear the date if unchecked
        }
        if(check === false){
            console.log('Inside the invalid');
            console.log('Data for date ' +this.template.querySelector('lightning-input[data-id="Test11"]'));
            this.template.querySelector('lightning-input[data-id="Test11"]').setCustomValidity('Date is mandatory');
            this.template.querySelector('lightning-input[data-id="Test11"]').reportValidity();
        }
    }
    allowIncomplete = false;
    // Handler for Incomplete Credential Application Sent Date
    handleIncompleteDateChange(event) {
        this.incompleteDate = event.target.value;
        const selectedDate = new Date(this.incompleteDate);
        const today = new Date();
        today.setHours(0,0,0,0);
        if(selectedDate > today ){
            this.allowIncomplete = true
             this.showError('Date can not be in future');
        }else{
  this.allowIncomplete = false;
        }
      
    }

    // Handler for Complete Credential Application checkbox
    handleCompleteChange(event) {
        this.complete = event.target.checked;
        if (!this.complete) {
            this.completeDate = null;  // Clear the date if unchecked
        }
    }

    // Handler for Complete Credential Application Sent Date
    handleCompleteDateChange(event) {
        this.completeDate = event.target.value;
    }

    // Handler for Extended TAT checkbox
    handleExtendedChange(event) {
        this.extended = event.target.checked;
        if (!this.extended) {
            this.extendedDate = null;  // Clear the date if unchecked
        }
    }

    // Handler for Extended TAT Sent Date
    handleExtendedDateChange(event) {
        this.extendedDate = event.target.value;
    }

    // Handler for Discontinued Incomplete Data Element checkbox
    handleDiscontinuedChange(event) {
        this.discontinued = event.target.checked;
        if (!this.discontinued) {
            this.discontinuedDate = null;  // Clear the date if unchecked
        }
    }

    // Handler for Discontinued Incomplete Data Element Sent Date
    handleDiscontinuedDateChange(event) {
        this.discontinuedDate = event.target.value;
    }

    handleCancel() {
        Object.assign(this, this.original);
    }

    handleSave() {
        let input  = this.template.querySelector('input');
        if(!input.checkValidity()){
            input.reportValidity();
        }
        if(this.allowIncomplete ==true){
            this.showError('Date can not be in future');
        }
        let missing = '';
        if (this.incomplete && !this.incompleteDate) {missing = 'Date is mandatory for the selected notification.'};
        if (this.complete && !this.completeDate) {missing = 'Date is mandatory for the selected notification.'};
        if (this.extended && !this.extendedDate) {missing = 'Date is mandatory for the selected notification.'};
        if (this.discontinued && !this.discontinuedDate) {missing = 'Date is mandatory for the selected notification.'};

        if (missing.length) {
            this.showError(`Required: ${missing}`);
            return;
        }

        updateCredentialRequest({
            recordId: this.recordId,
            incomplete: this.incomplete,
            incompleteDate: this.incomplete ? this.incompleteDate : null,
            complete: this.complete,
            completeDate: this.complete ? this.completeDate : null,
            extended: this.extended,
            extendedDate: this.extended ? this.extendedDate : null,
            discontinued: this.discontinued,
            discontinuedDate: this.discontinued ? this.discontinuedDate : null
        })
            .then(() => {
                this.showSuccess('Credential Request updated.');
                this.original = {
                    incomplete: this.incomplete,
                    incompleteDate: this.incompleteDate,
                    complete: this.complete,
                    completeDate: this.completeDate,
                    extended: this.extended,
                    extendedDate: this.extendedDate,
                    discontinued: this.discontinued,
                    discontinuedDate: this.discontinuedDate
                };
            })
            .catch(err => {
                this.showError('Update failed: ' + err.body.message);
            });
    }

    get notIncomplete() { return !this.incomplete; }
    get notComplete() { return !this.complete; }
    get notExtended() { return !this.extended; }
    get notDiscontinued() { return !this.discontinued; }

    get isPristine() {
        return (
            this.incomplete === this.original.incomplete &&
            this.incompleteDate === this.original.incompleteDate &&
            this.complete === this.original.complete &&
            this.completeDate === this.original.completeDate &&
            this.extended === this.original.extended &&
            this.extendedDate === this.original.extendedDate &&
            this.discontinued === this.original.discontinued &&
            this.discontinuedDate === this.original.discontinuedDate
        );
    }

    showSuccess(msg) {
        this.dispatchEvent(new ShowToastEvent({ title: 'Success', message: msg, variant: 'success' }));
    }

    showError(msg) {
        this.dispatchEvent(new ShowToastEvent({ title: 'Error', message: msg, variant: 'error' }));
    }


}


-->
</apex:page>